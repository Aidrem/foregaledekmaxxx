<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FORSGALE — Surprise Love Game</title>
<link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-cream:#fffdf4;
    --soft-yellow:#fff8e0;
    --muted:#333;
    --card-bg: rgba(255,255,255,0.86);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Itim, system-ui, -apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(135deg,var(--bg-cream),var(--soft-yellow));}
  .logo{position:fixed;left:14px;top:10px;font-weight:800;color:var(--muted);background:rgba(255,255,255,0.85);padding:8px 10px;border-radius:8px;z-index:1200;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .wrap{max-width:1100px;margin:72px auto;padding:0 18px;}

  /* Scenes */
  .scene{display:none;}
  .scene.active{display:block;}
  .scene.active{display:block;}

.btn-container {
    display: flex;
    justify-content: center;
    gap: 20px; /* ระยะห่างระหว่างปุ่ม */
}


  /* Game UI */
  .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;align-items:start}
  .card{background:var(--card-bg);backdrop-filter:blur(6px);border-radius:14px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,0.06)}
  h2{margin:0 0 8px 0;color:var(--muted)}
  .small{font-size:13px;color:#666}
  .choices{display:flex;gap:12px;justify-content:center;margin-top:10px}
  .btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-size:20px;background:linear-gradient(180deg,#fff,#fff6f0);box-shadow:0 8px 26px rgba(0,0,0,0.06)}
  .btn:active{transform:translateY(2px)}
  .result{display:inline-block;padding:8px 12px;border-radius:999px;background:rgba(255,249,240,0.95);box-shadow:0 6px 18px rgba(0,0,0,0.04);font-weight:700}

  /* love card */
  .love-wrap{display:flex;flex-direction:column;align-items:flex-start;gap:8px}
  .love-actions{position:relative;display:inline-block;padding:8px}
  .yes-btn{padding:12px 18px;border-radius:999px;background:linear-gradient(180deg,#fff8f9,#ffdfe8);border:none;cursor:pointer;font-weight:700}
  .no-btn{position:absolute;top:50%;left:60%;transform:translate(-50%,-50%);padding:10px 14px;border-radius:999px;background:#fff;border:1px solid #eee;cursor:pointer}

  /* countdown screen */
  .centered{display:flex;align-items:center;justify-content:center;min-height:60vh;flex-direction:column}
  .count-txt{font-size:28px;font-weight:800;color:var(--muted);-webkit-text-stroke:1.5px white;text-align:center}

  /* final canvas container covers full screen */
  #finalCanvas{position:fixed;inset:0;z-index:999;background:linear-gradient(180deg, rgba(255,250,240,0.98), rgba(255,245,250,0.99));display:none}
  #finalOverlay{position:fixed;inset:0;z-index:1000;pointer-events:none;display:none}

  /* big fullscreen messages (center) */
  .big-msg{position:fixed;left:50%;top:45%;transform:translate(-50%,-50%);font-size:64px;font-weight:900;color:#000;text-align:center;pointer-events:none;
           -webkit-text-stroke:3px white; text-shadow:0 12px 40px rgba(255,160,180,0.16);z-index:1101}
  .big-msg.small{font-size:40px}

  /* spotify player box bottom-right */
  .spotify-embed{position:fixed;right:18px;bottom:18px;z-index:1200;border-radius:12px;overflow:hidden;box-shadow:0 12px 30px rgba(0,0,0,0.12)}
  .spotify-embed iframe{display:block;border:0}

  /* responsive */
  @media(max-width:920px){
    .grid{grid-template-columns:1fr}
    .logo{left:10px;top:8px}
    .big-msg{font-size:34px}
  }

</style>
</head>
<body>
  <div class="logo">FORSGALE</div>

  <div class="wrap">
    <!-- SCENE 1: Game -->
    <div id="scene-game" class="scene active">
      <div class="grid">
        <div class="card">
          <h2>Play Rock · Paper · Scissors</h2>
          <div class="small">Round: <span id="roundNum">1</span> — เล่นได้เรื่อย ๆ</div>
          <div class="choices" id="choiceButtons">
            <button class="btn choice" data-choice="rock">✊</button>
            <button class="btn choice" data-choice="paper">✋</button>
            <button class="btn choice" data-choice="scissors">✌️</button>
          </div>
          <div style="height:12px"></div>
          <div style="display:flex;justify-content:space-around;align-items:center">
            <div><div class="small">You</div><div id="youSel">—</div></div>
            <div><div class="small">Bot</div><div id="botSel">—</div></div>
          </div>
          <div style="height:12px"></div>
          <div style="text-align:center"><div id="resTag"></div></div>
        </div>

        <div class="card">
          <h2>Notes</h2>
          <div class="small">เล่นเรื่อย ๆ — จนชนะ (scissors)</div>
        </div>

        <div class="card">
          <h2>Sound & Test</h2>
          <div class="small">ทดสอบเสียง:</div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="testPop" class="btn">Play Pop</button>
            <button id="testWin" class="btn">Play Win</button>
            <button id="testLose" class="btn">Play Lose</button>
          </div>
        </div>
      </div>
    </div>

<!-- SCENE 2: Do you love me? -->
<div id="scene-love" class="scene">
    <div class="card">
        <h2>Do you love me?</h2>
        <div style="height:8px"></div>
        <div class="love-wrap">
            <div class="btn-container">
                <button id="yesLove" class="yes-btn">Yes</button>
                <button id="noLove" class="no-btn">No</button>
            </div>
        </div>
    </div>
</div>

          </div>
          <div class="small" id="loveNote">Win a round to unlock this</div>
        </div>
      </div>
    </div>

    <!-- SCENE 3: Wait/countdown -->
    <div id="scene-wait" class="scene">
      <div class="centered">
        <div class="count-txt" id="waitText">ให้ยูรอ 4 วิ</div>
      </div>
    </div>

    <!-- SCENE 4: Final (canvas) -->
    <div id="scene-final" class="scene">
      <!-- canvas fills screen via #finalCanvas -->
    </div>
  </div>

  <!-- Canvas overlay & big text -->
  <canvas id="finalCanvas"></canvas>
  <div id="finalOverlay"></div>
  <div id="bigMsg" class="big-msg" style="display:none">I love u galedekjoi</div>

  <!-- Spotify embed (hidden until final) -->
  <div id="spotifyBox" class="spotify-embed" style="display:none">
    <iframe id="spotifyIframe" src="https://open.spotify.com/embed/track/2lxZhv9vuzDKIWImiYhDh7?utm_source=generator&theme=0" width="280" height="80" allow="autoplay; clipboard-write; encrypted-media"></iframe>
  </div>

<script>
/* ============================
   Settings & utility
   ============================ */
const spotifyLink = "https://open.spotify.com/track/2lxZhv9vuzDKIWImiYhDh7?si=21b42d634fe74334";
const pastelColors = ['#ff4d4d','#ff80bf','#ffb3d9','#d1b3ff','#b3ecff','#fff0b3','#f6f6f6','#e8e4d7'];
// scene references
const sceneGame = document.getElementById('scene-game');
const sceneLove = document.getElementById('scene-love');
const sceneWait = document.getElementById('scene-wait');
const sceneFinal = document.getElementById('scene-final');
const finalCanvas = document.getElementById('finalCanvas');
const finalOverlay = document.getElementById('finalOverlay');
const bigMsg = document.getElementById('bigMsg');
const spotifyBox = document.getElementById('spotifyBox');
const loveNote = document.getElementById('loveNote');
const yesLove = document.getElementById('yesLove');
const noLove = document.getElementById('noLove');

let roundCount = 0;
let unlocked = false;

/* ---------------------------
   Audio: use WebAudio API to synthesize sounds (win/lose/pop/boom)
   - This avoids needing external files; runs in browser
   --------------------------- */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();

function playTone(freq, type='sine', time=0.14, gain=0.15){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time);
  setTimeout(()=>{ o.stop(); }, time*1000 + 20);
}
// small bubbly win
function playWinSound(){ playTone(880,'sine',0.18,0.12); playTone(1320,'sine',0.12,0.08); }
// low lose sound
function playLoseSound(){ playTone(220,'sawtooth',0.18,0.15); }
// comedic boom created by noise burst & low pitch
function playBoom(){
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  o.type = 'sine';
  o.frequency.setValueAtTime(80, now);
  const g = audioCtx.createGain();
  g.gain.setValueAtTime(0.001, now);
  g.gain.exponentialRampToValueAtTime(1.2, now + 0.02);
  g.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(now);
  o.stop(now + 0.52);

  // noise burst
  const bufferSize = audioCtx.sampleRate * 0.25;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++){
    data[i] = (Math.random() * 2 - 1) * Math.exp(-3 * i / bufferSize);
  }
  const nb = audioCtx.createBufferSource();
  nb.buffer = buffer;
  const ng = audioCtx.createGain();
  ng.gain.setValueAtTime(0.9, now);
  ng.gain.exponentialRampToValueAtTime(0.001, now+0.4);
  nb.connect(ng); ng.connect(audioCtx.destination);
  nb.start(now);
}

/* ============================
   Game logic (RPS)
   ============================ */
const choices = document.querySelectorAll('.choice');
const youSel = document.getElementById('youSel');
const botSel = document.getElementById('botSel');
const resTag = document.getElementById('resTag');
const roundNum = document.getElementById('roundNum');

function botPlay(){ const arr=['rock','paper','scissors']; return arr[Math.floor(Math.random()*arr.length)]; }
function decide(p,b,nextRound){
  // special rule: if nextRound === 2 and p === 'scissors' -> win
  if(nextRound === 2 && p === 'scissors') return 'win';
  if(p === b) return 'draw';
  if((p==='rock'&&b==='scissors')||(p==='paper'&&b==='rock')||(p==='scissors'&&b==='paper')) return 'win';
  return 'lose';
}

choices.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const c = btn.dataset.choice;
    roundCount++;
    roundNum.textContent = roundCount;
    youSel.textContent = c;
    const b = botPlay(); botSel.textContent = b;
    const r = decide(c,b,roundCount);
    setTimeout(()=>{
      resTag.innerHTML = '<span class="result">' + (r==='win' ? 'You win!' : r==='lose' ? 'You lose' : 'Draw') + '</span>';
      if(r === 'win'){
        playWinSound();
        unlocked = true;
        loveNote.textContent = 'Unlocked! Click Yes to continue';
        // redirect to love scene immediately
        setTimeout(()=> showScene('love'), 700);
      } else if(r === 'lose'){
        playLoseSound();
        // lose -> reset round or allow continue (we keep playing)
      }
    }, 350);
  });
});

/* ============================
   Scene switching helper
   ============================ */
function showScene(id){
  // hide all
  [sceneGame, sceneLove, sceneWait, sceneFinal].forEach(s=> s.classList.remove('active'));
  if(id === 'game') sceneGame.classList.add('active');
  if(id === 'love') sceneLove.classList.add('active');
  if(id === 'wait') sceneWait.classList.add('active');
  if(id === 'final') sceneFinal.classList.add('active');
}

/* ============================
   Love scene interactions
   ============================ */
noLove.addEventListener('mouseenter', ()=>{
  // move to random spot smoothly
  const parentRect = document.body.getBoundingClientRect();
  const top = 10 + Math.random()*70;
  const left = 10 + Math.random()*75;
  noLove.style.transition = 'transform 0.15s ease, top 0.2s ease, left 0.2s ease';
  noLove.style.position = 'absolute';
  noLove.style.top = top + '%';
  noLove.style.left = left + '%';
});
yesLove.addEventListener('click', (e)=>{
  if(!unlocked){ alert('Win a round to unlock this!'); return; }
  // open spotify in new tab/window as user gesture to increase chance autoplay allowed
  try{
    window.open(spotifyLink, '_blank');
  }catch(err){}
  // go to wait scene and countdown
  startWaitAndFinal();
});

/* ============================
   Wait -> then final start
   ============================ */
function startWaitAndFinal(){
  showScene('wait');
  let sec = 4;
  const waitText = document.getElementById('waitText');
  waitText.textContent = `ให้ยูรอ ${sec} วิ`;
  const t = setInterval(()=>{
    sec--;
    if(sec > 0) waitText.textContent = `ให้ยูรอ ${sec} วิ`;
    else {
      clearInterval(t);
      // proceed to final
      showScene('final');
      // reveal canvas & spotify player
      startFinalExperience();
    }
  }, 1000);
}

/* ============================
   Canvas final experience
   - hearts & messages spawn from bottom
   - shimmer/glow on text
   - explode (particles) when reach top (play boom)
   ============================ */
const canvas = finalCanvas;
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
});

// particle arrays
let floats = []; // rising hearts/text
let fragments = []; // particles after explosion
let spawnInterval = null;
let msgToggleInterval = null;

const messages = ["I love u galedekjoi","เลิฟยูเกลเด็กโจ๋เด็กจ่อย"];

function randomRange(a,b){ return a + Math.random()*(b-a); }

function spawnFloat(){
  // spawn a heart or message (mostly hearts, occasional large message element as moving object)
  const isMessage = Math.random() < 0.08; // 8% chance spawn moving message element
  if(isMessage){
    const txt = messages[Math.floor(Math.random()*messages.length)];
    const size = Math.floor(randomRange(36, 80));
    floats.push({
      kind:'text',
      x: randomRange(50, W-50),
      y: H + 60,
      vx: randomRange(-0.6,0.6),
      vy: -randomRange(2.2,4.2),
      size,
      text: txt,
      color: '#000',
      life: 0
    });
  } else {
    // heart
    const color = pastelColors[Math.floor(Math.random()*pastelColors.length)];
    const size = Math.floor(randomRange(18, 96));
    floats.push({
      kind:'heart',
      x: randomRange(20, W-20),
      y: H + 30,
      vx: randomRange(-0.6,0.6),
      vy: -randomRange(2.8,5.6),
      size,
      color,
      life: 0,
      rotation: randomRange(-40,40),
      glow: true
    });
  }
}

// draw rounded heart via path, scale to size
function drawHeart(x,y,size,color,rotation,alpha=1){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rotation * Math.PI/180);
  ctx.globalAlpha = alpha;
  ctx.shadowColor = color;
  ctx.shadowBlur = Math.max(4, size*0.18);
  ctx.fillStyle = color;
  // heart path (simple)
  const s = size/20;
  ctx.beginPath();
  ctx.moveTo(0, -10*s);
  ctx.bezierCurveTo(10*s, -30*s, 40*s, -30*s, 40*s, -10*s);
  ctx.bezierCurveTo(40*s, 10*s, 20*s, 28*s, 0, 40*s);
  ctx.bezierCurveTo(-20*s, 28*s, -40*s, 10*s, -40*s, -10*s);
  ctx.bezierCurveTo(-40*s, -30*s, -10*s, -30*s, 0, -10*s);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function drawTextObj(obj, alpha=1){
  ctx.save();
  ctx.globalAlpha = alpha;
  ctx.font = `bold ${obj.size}px Itim, Arial`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  // stroke white rounded
  ctx.lineWidth = Math.max(6, obj.size*0.08);
  ctx.strokeStyle = 'rgba(255,255,255,0.98)';
  ctx.strokeText(obj.text, obj.x, obj.y);
  // fill black
  ctx.fillStyle = '#000';
  // glow
  ctx.shadowColor = '#ffd1e0';
  ctx.shadowBlur = Math.max(8, obj.size*0.2);
  ctx.fillText(obj.text, obj.x, obj.y);
  ctx.restore();
}

function spawnFragments(x,y,color,count=10){
  for(let i=0;i<count;i++){
    fragments.push({
      x: x,
      y: y,
      vx: randomRange(-4,4),
      vy: randomRange(-6,-1),
      size: randomRange(4,18),
      life: 40 + Math.floor(Math.random()*30),
      color
    });
  }
}

function updateAndDraw(){
  ctx.clearRect(0,0,W,H);
  // update floats
  for(let i=floats.length-1;i>=0;i--){
    const f = floats[i];
    f.x += f.vx;
    f.y += f.vy;
    f.vy += 0.02; // slight gravity to slow then float
    f.life++;
    // draw
    if(f.kind === 'heart'){
      drawHeart(f.x, f.y, f.size, f.color, f.rotation, 1);
    } else {
      drawTextObj(f, 1);
    }
    // if reached top -> explode
    if(f.y + (f.size* -0.4) < -40){
      // explosion: fragments + pop sound
      spawnFragments(f.x, f.y, (f.color||'#fff'), 14 + Math.floor(f.size/6));
      // comic boom sound
      playBoom();
      floats.splice(i,1);
    }
    // remove if too old off-screen
    else if(f.y < -200 || f.x < -200 || f.x > W+200) {
      floats.splice(i,1);
    }
  }

  // update fragments
  for(let j=fragments.length-1;j>=0;j--){
    const p = fragments[j];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.18; // gravity falls down a bit (natural)
    p.life--;
    ctx.save();
    ctx.globalAlpha = Math.max(0, p.life/70);
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, Math.max(1,p.size*0.35), 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
    if(p.life <= 0) fragments.splice(j,1);
  }

  requestAnimationFrame(updateAndDraw);
}

/* START final: spawn loop + message toggle + show spotify */
function startFinalExperience(){
  // show canvas & overlay & big message
  finalCanvas.style.display = 'block';
  finalOverlay.style.display = 'block';
  bigMsg.style.display = 'block';
  spotifyBox.style.display = 'block';

  // ensure AudioCtx resumed on user gesture -- yes was clicked
  if(audioCtx.state === 'suspended'){ audioCtx.resume(); }

  // spawn rhythm: fast lively
  spawnInterval = setInterval(spawnFloat, 90);

  // spawn some initial burst
  for(let i=0;i<20;i++) spawnFloat();

  // message toggle big center
  let tgl = 0;
  bigMsg.textContent = messages[tgl];
  msgToggleInterval = setInterval(()=>{
    tgl = (tgl+1)%messages.length;
    // animate fade
    bigMsg.style.opacity = 0;
    setTimeout(()=>{ bigMsg.textContent = messages[tgl]; bigMsg.style.opacity = 1; }, 280);
  }, 1600);

  // start render loop
  updateAndDraw();
}

/* ============================
   Test buttons
   ============================ */
document.getElementById('testPop').addEventListener('click', ()=>playBoom());
document.getElementById('testWin').addEventListener('click', ()=>playWinSound());
document.getElementById('testLose').addEventListener('click', ()=>playLoseSound());

/* ============================
   Init & helpers
   ============================ */
showScene('game'); // start at game

// small UX: on first user click, resume audio context (some browsers require)
document.addEventListener('click', ()=> {
  if(audioCtx.state === 'suspended') audioCtx.resume();
}, {once:true});

// Optional: if user navigates back to game, stop final loops
function stopFinal(){
  clearInterval(spawnInterval);
  clearInterval(msgToggleInterval);
  floats = [];
  fragments = [];
  bigMsg.style.display = 'none';
  finalCanvas.style.display = 'none';
  finalOverlay.style.display = 'none';
  spotifyBox.style.display = 'none';
}

</script>
</body>
</html>
